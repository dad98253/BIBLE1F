	PROGRAM MERGE
	INTEGER*2 I2A1,I2A2,I2B1,I2B2
	DIMENSION LENRS(4,200) , NUMLU(4)
	OPEN ( UNIT = 7 , FILE = 'MERGE.DAT' , STATUS = 'OLD' )
	I = 1
	READ ( 7 , 2 , END = 9998 ) LENRUN , NUMRUN , NUMLU(1) ,
     +	NUMLU(2)
    2	FORMAT ( 8I10 )
    1	CONTINUE
	READ ( 7 , 2 , END = 10 ) ( LENRS(J,I),J=1,2 )
	I = I + 1
	GO TO 1
   10	CONTINUE
	CLOSE ( 7 )
C
	LIN1 = 1
	LIN2 = 2
	LOUT1 = 3
	LOUT2 = 4
	OPEN ( UNIT = LIN1 , FILE = 'TAPE1.DAT' , STATUS = 'UNKNOWN'
     +	     , FORM = 'UNFORMATTED' , BLOCKSIZE = 60 000 )
	OPEN ( UNIT = LIN2 , FILE = 'TAPE2.DAT' , STATUS = 'UNKNOWN'
     +	     , FORM = 'UNFORMATTED' , BLOCKSIZE = 60 000 )
	OPEN ( UNIT = LOUT1 , FILE = 'TAPE3.DAT' , STATUS = 'UNKNOWN'
     +	     , FORM = 'UNFORMATTED' , BLOCKSIZE = 60 000 )
	OPEN ( UNIT = LOUT2 , FILE = 'TAPE4.DAT' , STATUS = 'UNKNOWN'
     +	     , FORM = 'UNFORMATTED' , BLOCKSIZE = 60 000 )
C
	NPASS = 0
  100	CONTINUE
	NPASS = NPASS + 1
	NUMLU(LOUT1) = 0
	NUMLU(LOUT2) = 0
	IF ( NUMLU(LIN1) + NUMLU(LIN2) .EQ. 2 ) CLOSE ( UNIT =
     +	    LOUT2 , STATUS = 'DELETE' )
	NLOOP = MIN ( NUMLU(LIN1) , NUMLU(LIN2) )
C
	DO 600 J = 1 , NLOOP
	    JSAVE = J
	    WRITE ( * , 101 ) NPASS , J , NUMLU(LIN1) - 1 , LIN1 ,
     +			      NUMLU(LIN2) - 1 , LIN2
  101	FORMAT ( 1H+ , ' PASS' , I3 , ', RUN' , I3 , ' :' , I3 ,
     +		 ' RUNS REMAINING ON UNIT' ,
     +		 I3 , ' ,' , I3 , ' RUNS ON UNIT' , I3 )
	    LNEW = LENRS(LIN1,J) + LENRS(LIN2,J)
	    READ ( LIN1 , END = 19999 ) I2A1 , I2A2
	    READ ( LIN2 , END = 29999 ) I2B1 , I2B2
C
	    DO 500 I = 1 , LNEW
		IF ( I2A1 - I2B1 ) 200 , 300 , 400
  200		CONTINUE
		    WRITE ( LOUT1 ) I2A1 , I2A2
		    READ ( LIN1 , END = 19999 ) I2A1 , I2A2
		    GO TO 500
  300		CONTINUE
		    IF ( I2B2 .GT. I2A2 ) GO TO 200
  400		CONTINUE
		    WRITE ( LOUT1 ) I2B1 , I2B2
		    READ ( LIN2 , END = 29999 ) I2B1 , I2B2
  500	    CONTINUE
C
	    IF ( I2B1 .NE. 32 000 .OR. I2A1 .NE. 32 000 ) THEN
		WRITE ( * , * ) ' ERROR : FILE NOT AT END-OF-BLOCK'
		STOP 500
	    END IF
C
	    WRITE ( LOUT1 ) I2B1 , I2B2
	    NUMLU(LOUT1) = NUMLU(LOUT1) + 1
	    KIND = NUMLU(LOUT1)
	    LENRS(LOUT1,KIND) = LNEW
	    LT = LOUT1
	    LOUT1 = LOUT2
	    LOUT2 = LT
	    NUMLU(LIN1) = NUMLU(LIN1) - 1
	    NUMLU(LIN2) = NUMLU(LIN2) - 1
C
  600	CONTINUE
	IF ( NUMLU(LIN2) .NE. 0 ) THEN
	    LT = LIN2
	    LIN2 = LIN1
	    LIN1 = LT
	END IF
	IF ( NUMLU(LIN1) .NE. 0 ) THEN
	    IF ( NUMLU(LIN1) .NE. 1 ) STOP 7878
	    KIND = JSAVE + 1
	    LNEW = LENRS(LIN1,KIND)
	    DO 700 I = 1 , LNEW + 1
		READ ( LIN1 , END = 19999 ) I2A1 , I2A2
		WRITE ( LOUT1 ) I2A1 , I2A2
  700	    CONTINUE
	    NUMLU(LOUT1) = NUMLU(LOUT1) + 1
	    KINDO = NUMLU(LOUT1)
	    LENRS(LOUT1,KINDO) = LENRS(LIN1,KIND)
	    NUMLU(LIN1) = NUMLU(LIN1) - 1
	END IF
	IF ( NUMLU(LOUT1) + NUMLU(LOUT2) .EQ. 1 ) GO TO 900
	LT = LOUT1
	LOUT1 = LIN1
	LIN1 = LT
	LT = LOUT2
	LOUT2 = LIN2
	LIN2 = LT
	DO 800 I = 1 , 4
	    REWIND I
  800	CONTINUE
	GO TO 100
C
  900	CONTINUE
	DO 1100 I = 1 , 4
	    IF ( I .EQ. LOUT1 .OR. I .EQ. LOUT2 ) GO TO 1100
	    CLOSE ( UNIT = I , STATUS = 'DELETE' )
 1100	CONTINUE
	IF ( LOUT2 .EQ. 1 ) GO TO 10 000
	OPEN ( UNIT = 1 , FILE = 'TAPE1.DAT' , STATUS = 'NEW'
     +	     , FORM = 'UNFORMATTED' , BLOCKSIZE = 60 000 )
	    REWIND LOUT2
	    NLOOP = LENRS(LOUT2,1)
	    DO 1000 J = 1 , NLOOP
		JSAVE = J
		READ ( LOUT2 , END = 39999 ) I2A1 , I2A2
		WRITE ( 1 ) I2A1 , I2A2
 1000	    CONTINUE
	    READ ( LOUT2 , END = 49999 ) I2A1 , I2A2
	    WRITE ( 1 ) I2A1 , I2A2
	    IF ( I2A1 .NE. 32 000 ) THEN
		WRITE ( * , * ) ' ERROR : END-OF-BLOCK NOT FOUND'
		STOP 1000
	    END IF
C
	    CLOSE ( UNIT = LOUT2 , STATUS = 'DELETE' )
	GO TO 10 000
C
 9998	CONTINUE
	WRITE ( * , * ) ' ERROR : NO MERGE CONTROL FILE'
	STOP 9998
19999	CONTINUE
	WRITE ( * , * ) ' ERROR : PREMATURE END-OF-FILE ON A MERGE'
     + , ' INPUT OR SCRATCH FILE'
	WRITE ( * , 99991 ) LIN1 , JSAVE
99991	FORMAT ( ' UNIT =' , I2 , ' RUN NUMBER =' , I3 )
	WRITE ( 9 , 99992 ) NUMLU , ((LENRS(I,J),I=1,4),J=1,200)
99992	FORMAT ( ' NUMLU' / 4I10 / ' LENRS' / ( 4I10 ) )
	STOP 19999
29999	CONTINUE
	WRITE ( * , * ) ' ERROR : PREMATURE END-OF-FILE ON A MERGE'
     + , ' INPUT OR SCRATCH FILE'
	WRITE ( * , 99991 ) LIN2 , JSAVE
	WRITE ( 9 , 99992 ) NUMLU , ((LENRS(I,J),I=1,4),J=1,200)
	STOP 29999
39999	CONTINUE
	WRITE ( * , * ) ' ERROR : PREMATURE END-OF-FILE ON A MERGE'
     + , ' INPUT OR SCRATCH FILE DURING COPY'
	WRITE ( * , 99991 ) LOUT2 , JSAVE
	WRITE ( 9 , 99992 ) NUMLU , ((LENRS(I,J),I=1,4),J=1,200)
	STOP 39999
49999	CONTINUE
	WRITE ( * , * ) ' ERROR : PREMATURE END-OF-FILE ON A MERGE'
     + , ' INPUT OR SCRATCH FILE '
	WRITE ( * , * ) '         WHILE READING END-OF-RUN MARKER'
	WRITE ( * , 99991 ) ISAVE , JSAVE
	WRITE ( 9 , 99992 ) NUMLU , ((LENRS(I,J),I=1,4),J=1,200)
	STOP 49999
10000	CONTINUE
C
	END
